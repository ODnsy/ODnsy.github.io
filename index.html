<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>NLP Research</title>
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
  </head>
  <body>

    <h4>請輸入句子或讀取檔案後，按執行：</h4>
    <button class="button" type="button" id="file_select">讀取檔案</button>
    <br>
    <br>
    <button id="submit-button" type="submit" pys-onClick="my_function">執行</button>
    <br>
    <br>
    <p>輸入句子:</p>
    <div id="filename"></div>
    <div id="filesize"></div>
    <div id="filetype"></div>
    <div id="filedate"></div>
    <br>
    <textarea rows="10" cols="100" id="content"></textarea>
    <br>
    <br>
    <p>結果:</p>
    <div id="test-output"></div>
    <py-script>
import asyncio
import sys
from js import alert, document, Object, window, console
from pyodide import create_proxy, to_js
import re

def clear_data():
  document.getElementById("filename").innerHTML = ''
  document.getElementById("filesize").innerHTML = ''
  document.getElementById("content").value = ''

async def file_select(event):
	clear_data()
	try:
		options = {
			"multiple": False,
			"startIn": "documents"
		}
		fileHandles = await window.showOpenFilePicker(Object.fromEntries(to_js(options)))
	except Exception as e:
		console.log('Exception: ' + str(e))
		return

	for fileHandle in fileHandles:
		file = await fileHandle.getFile()
		document.getElementById("filename").innerHTML = 'File Name: ' + file.name
		document.getElementById("filesize").innerHTML = 'File Size: ' + str(file.size)
		document.getElementById("filetype").innerHTML = 'File Type: ' + str(file.type)
		document.getElementById("filedate").innerHTML = 'File date: ' + str(file.lastModifiedDate)
		content = await file.text()
		document.getElementById('content').value = content

def setup_button():
	# Create a Python proxy for the callback function
	file_select_proxy = create_proxy(file_select)
	# Set the listener to the callback
	document.getElementById("file_select").addEventListener("click", file_select_proxy, False)

setup_button()

dict_vision=["咖啡","金黃","蔚藍","翠綠","鮮紅","湛藍","烏溜溜","黃澄澄","綠油油","白皚皚","黑漆漆","毛絨絨","水汪汪","白皙的","閃閃發亮","紅黃","紅色","嶄新的","白色","紅色","黃色","綠色","藍色","紫色"]
dict_listen=["叮叮咚咚","嘩啦嘩啦","淅瀝淅瀝","滴滴答答","轟隆轟隆","吱吱喳喳","叩叩叩","撲簌撲簌","呼嚕呼嚕"]
dict_object=["細細","長長","尖尖","長長","扁扁","方方","正正","寬寬","厚厚","小小","圓圓","大大"]
dict_smell=["酸甜","苦澀","酸中帶甜","白Q細滑","油而不膩","香醇鮮美","香味四溢","香味"]
dict_touch=["粗粗的","光滑柔順","質地輕柔","濕濕黏黏","柔軟"]

def cut_sentence(sentence):
  sentence = re.sub("\n","",sentence)
  s = re.split('。|，|；', sentence)
  if(len(s)>1):
    s.pop() #去掉最後一個空值
  return(s)

def get_dict(sentence,dict,dict_add):
  for i in range (len(sentence)):
    for j in range (len(dict)):
      if(sentence[i].find(dict[j])>-1):
        sentence[i]+=dict_add
        break
  return(sentence)

def show_dict(sentence_dict):
  sentence_dict=get_dict(sentence_dict,dict_vision,"(視覺)")
  sentence_dict=get_dict(sentence_dict,dict_listen,"(聽覺)")
  sentence_dict=get_dict(sentence_dict,dict_object,"(形狀大小)")
  sentence_dict=get_dict(sentence_dict,dict_smell,"(味覺和嗅覺)")
  sentence_dict=get_dict(sentence_dict,dict_touch,"(觸覺)")
  return(sentence_dict)


def my_function(*args, **kwargs):   
    console.log(f'args: {args}')
    console.log(f'kwargs: {kwargs}')
    text = Element('content').element.value
    #print('text:', text)
    console.log(f'text: {text}')
    Element('test-output').element.innerText = show_dict(cut_sentence(text))

    </py-script>
  </body>
</html>
